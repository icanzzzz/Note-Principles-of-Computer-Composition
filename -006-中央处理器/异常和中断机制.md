---
title: 中断系统
---



# 概述

## 基本概念

- 断点：中断响应时主程序停下的地址

## 引起中断的因素

- 人为设置的中断：例如“转管指令”
- 程序性事故：如定点溢出、浮点溢出、操作码无法识别、触发中出现“非法”等
- 硬件故障：电源掉电、插件接触不良、磁表面损坏等
- I/O设备：I/O设备被启动后，一旦准备就绪，就向CPU发出中断请求
- 外部事件：例如用户通过键盘来中断现行程序

## 中断的分类

### 可屏蔽中断

- 通过可屏蔽中断请求线INTR向CPU发出的中断请求
- CPU可通过在中断控制器中设置相应的屏蔽字来决定是否屏蔽
- CPU根据该中断源是否被屏蔽来确定是否给予响应

### 不可屏蔽中断

- 通过不可屏蔽中断请求线NMI向CPU发出的中断请求
- 这类中断CPU不能禁止响应，CPU快速处理这类紧急事件
- 一般是非常紧急的硬件故障，如电源掉电

# 中断请求标记和中断判优逻辑

## 中断请求标记

- 中断请求触发器INTR
  - 作用：判断是哪个中断源提出请求（一个中断源一个INTR）
  - 触发器可集中设置在CPU内，组成中断请求标记寄存器（每一位对应一个中断源）；也可以分散到各个中断源中

## 中断判优逻辑

### 硬件排队

- 链式排队器
  - 在接口电路内分别设置各个设备的排队器
  - 每个接口电路中都设有一个非门和一个与非门
  - 当有一个或多个中断源提出中断请求时，排队器输出端INTR~i~只有一个高电平
- 例如：集中设置在CPU内的排队器![image-20250415195941792](./resource/image-20250415195941792.png)

### 软件排队

- 通过编写查询程序实现
- 程序按中断源的优先级从高到低依次查询各个中断源是否有中断请求

# 中断服务程序入口地址的寻找

## 硬件向量法

- 利用硬件产生向量地址，根据向量地址找到中断服务程序的入口地址
- 利用向量地址找中断服务程序入口地址的方法（2种）
  - 无条件跳转指令：在向量地址指向的存储单元中放一条无条件转移指令
  - 中断向量表：设置中断向量表，该表在存储器内，存储单元的地址是向量地址，存储单元中的内容是入口地址。将入口地址加载到PC
- 硬件向量法寻找入口地址速度快，现代计算机普遍采用这种方法

## 软件查询法

- 用软件寻找中断服务程序的入口地址
- 当查找到某一中断源有中断请求时，安排转移指令直接指向此中断源的中断服务程序的入口地址
- 便于修改优先级，更灵活

# 中断响应

## 中断响应的条件

- 在中断系统设有“==允许中断触发器EINT==”，它可以被开中断指令置1，被关中断指令置0
- ENIT = 1时，CPU允许响应中断源的请求；反之CPU禁止响应中断

## 响应中断的时间

- CPU总是在==指令执行周期结束后==发送查询信号到每一个中断源的中断请求触发器INTR中。若有请求，则查询信号会将中断请求触发器INTR的输出端置1，将中断请求信号发送到排队电路。CPU根据排队电路执行中断程序进入中断周期
- 为了防止因某些指令执行时间很长，导致CPU在执行周期结束时查询中断请求过迟而出错，可在指令执行过程中设置若干个查询断点，CPU在每个查询断点均发出查中断询信号，以便发现有中断请求便可及时响应

## 中断隐指令

- 在响应中断时硬件直接实现，不是指令系统中的一条真正的指令，实质是硬件的一系列自动操作
- 具体操作
  1. 保护最小上下文
     - 断点PC中的值存于特定地址（0号地址）内，断点进栈
     - 状态寄存器的值自动进栈
  2. 硬件==关中断==
  3. 寻找服务程序入口地址

# 保护现场和恢复现场

## 保护现场

- ==断点==：==中断隐指令==完成
- ==寄存器内容==：==中断服务程序==完成

## 恢复现场

- 均由==中断服务程序==完成

# 多重中断

## 概念

- 多重中断（中断嵌套）：CPU正在执行一个中断服务程序时，又有另一个中断源提出新的中断请求，CPU响应了这个新的中断请求，暂时停止正在运行的服务程序
- 单重中断：CPU对新的请求不予响应，等到执行完当前的中断服务程序后再响应

## 实现条件

- 提前设置==开中断==指令
- ==优先级别高==的中断源==有权中断优先级别低==的中断源

## 屏蔽技术

